-- select product (checked out)
SELECT pt.name AS Product_type, p.name Product_name , p.id AS Product_id
FROM Product AS p, ProductType AS pt, Item AS i, CheckoutStatus AS cs, CheckoutStatusValue AS csv
WHERE p.product_type_id = pt.id
AND p.id = i.product_id
AND i.sku = cs.sku
AND cs.status_id = csv.id
AND csv.value = 'OUT'
ORDER BY pt.name;

--select product (fined)
SELECT pt.name AS Product_type, p.name AS Product_name ,p.id, csf.cost as fine, pt.fine_multiplier as multiplier, 
CASE WHEN csv.value = 'OVERDUE' THEN 'Yes'
ELSE 'No'
END OverDue
FROM Product AS p, ProductType AS pt,CheckoutFine as csf, Item AS i, CheckoutStatus AS cs, CheckoutStatusValue AS csv, FineStatusValue as fsv
WHERE csf.checkoutstatus_id = cs.id
AND csf.status = fsv.id
AND p.product_type_id = pt.id
AND p.id = i.product_id
AND i.sku = cs.sku
AND cs.status_id = csv.id
AND csv.value = 'OVERDUE';

-- select product (missing)
SELECT pt.name, p.name, p.id, p.cost
FROM Product AS p, ProductType AS pt,Item AS i, CheckoutStatus AS cs, CheckoutStatusValue AS csv
WHERE p.product_type_id = pt.id
AND p.id = i.product_id
AND i.sku = cs.sku
AND cs.status_id = csv.id
AND csv.value = 'LOST'
ORDER BY pt.name, p.name;

-- select product (inventory)
SELECT pt.name, p.name, p.id, p.cost 
FROM Product AS p, ProductType AS pt, Item AS i, CheckoutStatus AS cs, CheckoutStatusValue AS csv
WHERE p.product_type_id = pt.id
AND p.id = i.product_id
AND i.sku = cs.sku
AND cs.status_id = csv.id
AND csv.value = 'RETURNED'
ORDER BY pt.name, p.name;

-- select product (product info)
SELECT pt.name AS Product_Type,p.name AS Product_name,p.id AS Product_id, p.cost
FROM Product AS p, ProductType AS pt
WHERE p.product_type_id = pt.id
ORDER BY pt.name, p.name;
-----------------------------------------------------------------------------------------
-- select user (checked out)
SELECT u.last_name || ', '||u.first_name AS User_Name, ut.name AS User_type,u.id, p.name AS Product_name, p.id AS Product_id
FROM User AS u, UserType AS ut, CheckoutStatus AS cs, CheckoutStatusValue AS csv, Item AS i, Product AS p
WHERE u.user_type_id = ut.id
AND i.product_id = p.id
AND cs.sku = i.sku
AND u.id = cs.user_id
AND cs.status_id = csv.id
AND csv.value = 'OUT' 
ORDER BY user.last_name;

--select user (held)
SELECT u.last_name || ', '||u.first_name AS User_Name, ut.name AS User_type, u.id, p.name Product_name, p.id AS Product_id
FROM User AS u, UserType AS ut, ProductHold AS ph, Product AS p
WHERE u.user_type_id = ut.id
AND ph.user_id = u.id 
AND p.id = ph.product_id
AND ph.completed = TRUE
ORDER BY user.last_name;

--select user (missing)
SELECT u.last_name || ', '||u.first_name AS User_Name, ut.name AS User_type,u.id, pt.name AS Product_Type,p.name AS Product_name,p.id AS Product_id, i.sku AS sku, p.cost
FROM User AS u,UserType AS ut, CheckoutStatus AS cs, CheckoutStatusValue AS csv, CheckoutFine AS cf, Item as i, Product AS p, ProductType AS pt, FineStatusValue as fsv
WHERE p.product_type_id = pt.id
AND i.product_id = p.id
AND cs.sku = i.sku
AND fsv.value = 'LOST'
AND cf.status = fsv.id
AND cf.checkoutstatus_id = cs.id
AND u.user_type_id = ut.id
AND u.id = cs.user_id
AND cs.status_id = csv.id
AND csv.value = 'OVERDUE'
ORDER BY user.last_name;

--select user (disabled)
SELECT u.last_name || ', '||u.first_name AS User_Name,ut.name AS User_type,u.id
FROM User AS u,UserType AS ut
WHERE u.user_type_id = ut.id
AND u.enabled = FALSE
ORDER BY user.last_name;                                   

-- select user (lifetime of total checked) 
SELECT u.first_name, u.last_name, u.id, pt.name, COUNT(*) AS total_checked
FROM User as u, ProductType AS pt, Product AS P, CheckoutStatus AS cs, Item AS i, 
WHERE u.id = cs.user_id
AND p.id = i.product_id 
AND i.sku = cs.sku
AND p.product_type_id = pt.id
WHERE cs.status_id = (SELECT id FROM  CheckoutStatusValue WHERE value = 'OUT')
GROUP BY u.first_name, u.last_name, u.id, pt.name
ORDER BY user.last_name;
---------------------------------------------------------------------------------------------
-- item (status of (in stock, checked, held or missing))
SELECT pt.name AS Product_type, p.name AS Product_name, i.sku AS sku
  CASE
    WHEN i.sku IS NOT NULL THEN 'Checked Out'
    WHEN ph.product_id IS NOT NULL AND ph.COMPLETED = TRUE THEN 'Held'
    WHEN i.sku NOT IN (
      SELECT sku FROM CheckoutStatus AS cs)
      AND i.product_id
      (SELECT product_id FROM ProductHold AS ph
	) THEN 'In Stock'
    ELSE 'Missing'
  END AS status
FROM Item AS i
JOIN Product AS p on i.product_id = p.id
JOIN ProductType AS pt on pt.id = p.product_type_id
LEFT JOIN CheckoutStatus AS cs on i.sku = cs.sku
LEFT JOIN ProductHold AS ph on ph.product_id = p.id
 
-- checked by user (if applicable)
SELECT u.id AS User_id, u.first_name, u.last_name, pt.name AS Product_Type, P.name AS item_name, i.sku AS sku, P.cost
FROM Item AS i, Product AS p,ProductType AS pt, CheckoutStatus AS cs, CheckoutStatusValue AS csv, User AS u
WHERE u.id = cs.user_id
AND p.product_type_id = pt.id
AND i.product_id = p.id
AND cs.sku = i.sku
AND cs.status_id = csv.id
AND csv.value = 'OUT' AND u.enabled = TRUE;

-- item (product info)
SELECT pt.name AS Product_Type, P.name AS item_name, i.sku AS sku, p.cost
FROM Item AS i, Product AS p, ProductType as pt
WHERE i.product_id = p.id
AND p.product_type_id = pt.id;